<html>
<head>
    <title>HAB's Location</title>
    <!--<meta http-equiv="refresh" content="30" />-->
    <meta charset="utf-8" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script type="text/javascript" src="leaflet/leaflet.js"></script>
    <script type="text/javascript" src="leafletembed.js"></script>
    <script type="text/javascript" src="leaflet-omnivore/leaflet-omnivore.min.js"></script>
    <script type="text/javascript" src="Chart.js/Chart.js"></script>
    <script type="text/javascript" src="Chart.Scatter/Chart.Scatter.js"></script>
    <script
              src="https://code.jquery.com/jquery-3.3.1.min.js"
              integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
              crossorigin="anonymous"></script>

</head>
<body>
    <h2><span id="distintivo"></span>'s status as of <span id="tiempo"></span> minutes ago:</h2>
    <h3>Battery: (<span class="voltios"></span> V)</h3>
    <canvas id="batteryChart" width="200" height="200"></canvas>
    <canvas id="historyChart" width="400" height="200"></canvas>
    <input type="button" onclick="recarga()" value="Recarga" ></input>
    <!-- <iframe width="<?=$width?>" height="<?=$height?>" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="<?=$embedUrl?>" style="border: 1px solid black"></iframe> -->
    <div id="map" style="width: 500px; height: 600px"></div>
    <br/>
    <small><!--<a href="">View Larger Map</a>--></small>
        <script>
            recarga();
            initmap();
             map.setView(new L.LatLng(40, 0),17); 
            //omnivore.gpx('s2g.php?file=tmplocation.log').addTo(map);

            // Charts.js
            var batteryCtx = document.getElementById("batteryChart").getContext("2d");
            var data = [
                {
                    value: "0",
                    color: "rgba(0,0,220,0.8)",
                    highlight: "rgba(0,0,220,1)",
                    label: "Charge",
                },
                {
                    value: 0,
                    color: "rgba(0,0,0,0)",
                    highlight: "rgba(0,0,0,0)",
                    label: "Empty",
                }
            ]
            var batteryChart = new Chart(batteryCtx).Pie(data, {showScale: true});
            
            var historyCtx = document.getElementById("historyChart").getContext("2d");
            var historyData = [{
                label: 'Battery level',
                strokeColor: '#F16220',
                pointColor: '#F16220',
                pointStrokeColor: '#fff',
                data: [
                                ]
            },
            ];
            options = {
                pointDot: false,
                bezierCurve: false,
                scaleType: "date",
                useUtc: false,
                animation: false,
            }
            var historyChart = new Chart(historyCtx).Scatter(historyData,options);
        function recarga() {
            $.getJSON( 'https://api.aprs.fi/api/get?name=EA2DVJ-11&what=loc&apikey=109984.vUFksEiAq8PAsJQ&format=json', function ( data ) { alert(data);}   );
            /*$.ajax({
                //url: "https://api.aprs.fi/api/get?name=EA2DVJ-11&what=loc&apikey=109984.vUFksEiAq8PAsJQ&format=json",
                url: "https://api.aprs.fi/api/get",
                data: {name: "EA2DVJ-11", what: "loc", apikey: "109984.vUFksEiAq8PAsJQ",format: "json"},
                type: "GET",
                success: dibuja(data),
                beforeSend: function(request) {
                    request.setRequestHeader("User-Agent","HAB-tracker/0.0.1 (https://github.com/alejandroscf/hab-tracker)");
                },
            });*/
        };
        function dibuja(data) {
            $("#distintivo").text("EA2DVJ-11");
            console.log(data);
            
        }



        </script>

</body>
</html>
